<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="./web3.min.js"></script>  
    <script type="text/javascript" src="./utils.js"></script>  
    <script type="text/javascript">

    
let Acc=1;




    console.log('***Inicio');
    window.addEventListener('load', function () {
        console.log('***load');        
        if (typeof web3 !== 'undefined') {
            console.log('***Web3 Detected! ' + web3.currentProvider.constructor.name)
            window.web3 = new Web3(web3.currentProvider);
                    
        } else {
            console.log('***No Web3 Detected... using HTTP Provider')
            window.web3 = new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/<APIKEY>"));
        }
        console.log('***fin load');
    })



 /*    const sendEthButton = document.querySelector('.sendEthButton');
    //Sending Ethereum to an address
sendEthButton.addEventListener('click', () => {
  ethereum
    .request({
      method: 'eth_sendTransaction',
      params: [
        {
          from: accounts[0],
          to: '0x2f318C334780961FB129D2a6c30D0763d9a5C970',
          value: '0x29a2241af62c0000',
          gasPrice: '0x09184e72a000',
          gas: '0x2710',
        },
      ],
    })
    .then((txHash) => console.log(txHash))
    .catch((error) => console.error);
}); */




   



    function functionConnect() {
        console.log('***Inicio funcion connect');
        
        window.ethereum.enable();
        var accounts = web3.eth.getAccounts((error,result) => {
        //alert("xxxx");
        if (error) {
            console.log(error);
        } else {
            console.log("***Cuenta conectada: " + result);
            //alert("Cuenta Conectada: " + result);            
            document.getElementById("output").innerHTML =  result;

        }       
    }); 


        //var address, wei, balance
        //address = document.getElementById("address").value
            
        //try {
        //    web3.eth.getBalance(address, function (error, wei) {
        //    if (!error) {
        //        var balance = web3.fromWei(wei, 'ether');
        //        document.getElementById("output").innerHTML = balance + " ETH.";
        //    }
        //    });
        //} catch (err) {
        //document.getElementById("output").innerHTML = err;
        //}
        
        console.log('***Fin GB');


    }

    function envia() {
        //alert("envia"); 
        connect();    
        //alert("envia final");    
    }

    const connect = async () => {
        //alert("async 1");  
        let from;
        /*                     if (window.ethereum) {
                                web3 = new Web3(window.ethereum);            

                                //var BN = web3.utils.BN;
                                const form = document.getElementById('send'); //formulario 
                                const amountInput = document.getElementById('amount'); //caja de textos 
                                const recipientInput = document.getElementById('recipient'); //caja de texto
                                ;
                                alert("async 2");  
                                event.preventDefault();
                                //alert("async 3");  
                                //leemos los valores de las cajas de texto
                                const amount = amountInput.value;
                                const recipient = recipientInput.value;
                                //alert(amount);
                                //alert(recipient);
                                alert("async 4");  
                                //valida que la cuenta destino sea valida
                                //usando una funcion de web3, utils
                                //recibe como parametro el valor del input
                                //window.web3
                                if (!window.web3.utils.isAddress(recipient)) {
                                    alert('Dirección inválida');
                                return;
                                alert("async 5");  
                            }   
                            }     */
                            var accounts = web3.eth.getAccounts((error,result) => {        
        if (error) {
            console.log(error);
        } else {
            console.log("***xxzzzzCuenta conectada: " + result);            
            //document.getElementById("output").innerHTML =  "result";
            console.log(document.getElementById("output").innerHTML);
            Acc=result;

        }       
    }); 
    console.log("///////////////////////");
//alert ('result');
//alert (Acc);
console.log("*****>>>"+accounts +"<");
//let _from = "0x4AF92bF32A3824641c813013e108e5C1aAD90C3E";                           
let _from = document.getElementById("output").innerHTML;    
//recipient                      
let _to = "0x2f318C334780961FB129D2a6c30D0763d9a5C970";
//let _to = document.getElementById("recipient").innerText;    



                            ethereum
        .request({
        method: 'eth_sendTransaction',
        params: [
            {
            from: _from,
            //to: "0x2f318C334780961FB129D2a6c30D0763d9a5C970",
            to: _to,
            value: '0x29a2241af62c0000',
            gasPrice: '0x09184e72a000',
            gas: '0x2710',
            },
        ],
        })
        .then((txHash) => console.log(txHash))
        .catch((error) => console.error);
        //alert("async F");



    }

 




    console.log('***Fin');



    
    
    </script>













<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">

<title>Proyectoz de Dapp Jairo Lamus, Versión 1 </title>

</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>

    <p class="text-light bg-secondary">Dapp Project, Jairo Lamus, Versión 1. </p>
    <p></p>
    <a href="index.html" class="btn btn-secondary " tabindex="-1" role="button" aria-disabled="true">Home Page</a>
    <p>_____________________________________________________________________________________________________________________________________________________________________________________________________________________</p>
    <h1 center class="text-warning"> Transfer ETH</h1>
    <h3 class="text-warning">Transferencia de ETH</h3>
    <p>_____________________________________________________________________________________________________________________________________________________________________________________________________________________</p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <!-- <h5 class="text-dark">Please connect to your MetaMask and enter a valid ETH adress :</h5>
    <h6 class="text-dark">Por favor conecte su MetaMask e Introduzca la Adrress de Ethereum :</h6> -->
    
    
    <button type="button" onClick="functionConnect();"   class="btn btn-primary btn-lg">Connect MetaMask</button>
    <p>
    <div id="outputp" class="text-success h3 " > Cuenta Conectada:     </div>
    <div id="output" class="text-success h3 " >  </div> 
       
    



    <form id="send" style="margin-top: 10px;"></form>    
            _____________________________________________________________________________________________________________________________________________________________________________________________________________________</p>
            <!-- <a href="#" class="btn btn-primary btn-lg disabled" tabindex="-1" role="button" aria-disabled="true">Primary link</a> -->
            <div class="text-success h3 ">Dirección Destino: </div>
             <!-- <input type="text" size="50" id="address" />   -->
             <input size="50"    id="recipient" type="text" placeholder="0x2f318C334780961FB129D2a6c30D0763d9a5C970" >  
            <p>
            <p>_____________________________________________________________________________________________________________________________________________________________________________________________________________________</p>
            <p></p>
            <div class="text-success h3 ">Cantidad de ETH representada en weis: </div>
            <!-- <input type="text" size="20" id="address" />  -->
            <input id="amount" type="number" placeholder="Amount">
            <p>
            <p>_____________________________________________________________________________________________________________________________________________________________________________________________________________________</p>
            <!-- <button>Enviar</button>       -->
            <input id="EIBSBTN" type=button name="Submit" OnClick="envia()" value="Enviar">
            <button >Send Eth</button>
    </form>





</body>
</html>